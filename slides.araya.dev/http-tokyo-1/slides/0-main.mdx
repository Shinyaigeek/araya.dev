import { Card } from "@fusuma/client";

# Response Status Codes 3xx
    
---
## 参考資料

- [RFC7231](https://tools.ietf.org/html/rfc7231#section-6.4)
- [RFC7232](https://tools.ietf.org/html/rfc7232#section-4.1)
- [RFC7538](https://tools.ietf.org/html/rfc7538#section-3)
- [RFC7231 和訳](https://triple-underscore.github.io/RFC7231-ja.html)

---

## 3xx 系の Status Codes

- 300 Multiple Choices [RFC7231]
- 301 Moved Permanently [RFC7231]
- 302 Found [RFC7231]
- 303 See Other [RFC7231]
- 304 Not Modified [RFC7232]
- 305 Use Proxy [RFC7231]
- 306 (Unused) [RFC7231]
- 307 Temporary Redirect [RFC7231]
- 308 Permanent Redirect [RFC7538]

---
```
[RFC7231]より
------------

The 3xx (Redirection) class of status code indicates that further action needs to be taken by the user agent in order to fulfill the request.  If a Location header field (Section 7.1.2) is provided, the user agent MAY automatically redirect its request to the URI referenced by the Location field value, even if the specific status code is not understood.  Automatic redirection needs to done with care for methods not known to be safe, as defined in Section 4.2.1, since the user might not wish to redirect an unsafe request.
```

<!-- classes: alignleft -->

ステータスコード3xxは、

- リクエストを果たすためにはUAによるさらなるアクションが必要 ということを指示する。
- `Location` ヘッダが与えられていたら、UAはステータスコードを解釈できなくてもリダイレクトしてもよい。(MAY)

---

### redirectionの種類

```
[RFC7231]より
------------

1.  Redirects that indicate the resource might be available at a different URI, as provided by the Location field, as in the status codes 301 (Moved Permanently), 302 (Found), and 307 (Temporary Redirect).

2.  Redirection that offers a choice of matching resources, each capable of representing the original request target, as in the 300 (Multiple Choices) status code.

3.  Redirection to a different resource, identified by the Location field, that can represent an indirect response to the request, as in the 303 (See Other) status code.

4.  Redirection to a previously cached result, as in the 304 (Not Modified) status code.
```


1. `Locaion` フィールドで提供される、異なるURIが利用できる可能性があることを指示する(301, 302, 307) 
2. 元のリクエストターゲットを表現する能力を持つような、マッチするリソースの選択肢を提示する(300)
3. `Location` フィールドで特定される、間接的なレスポンスを表現可能な、異なるリソースを提示する(303)
4. すでにキャッシュされた結果へのリダイレクトを提示する(304)

---

### 301と302について
```
[RFC7231]より
------------

 Note: In HTTP/1.0, the status codes 301 (Moved Permanently) and 302 (Found) were defined for the first type of redirect ([RFC1945], Section 9.3).  Early user agents split on whether the method applied to the redirect target would be the same as the original request or would be rewritten as GET. Although HTTP originally defined the former semantics for 301 and 302 (to match its original implementation at CERN), and defined 303 (See Other) to match the latter semantics, prevailing practice gradually converged on the latter semantics for 301 and 302 as well.  The first revision of HTTP/1.1 added 307 (Temporary Redirect) to indicate the former semantics without being impacted by divergent practice.  Over 10 years later, most user agents still do method rewriting for 301 and 302; therefore, this specification makes that behavior conformant when the original request is POST.
 ```
 - 301と302はHTTP/1.0で定義された。
 - 初期のUAでは、ステータスコードが301, 302だったとき、リクエストターゲットへの適用に差がある。
    - メソッドを元のリクエストと同じにする。
    - メソッドをGETに書き換える。
- HTTP/1.1ではこのような実際の差分に影響されない307が追加された。
- 10年以上が経過した現在(_RFCの最終更新は2014年_)においても、ほとんどのUAはStatus codeが301/302の場合にはメソッドを書き換えている。

---

### 無限リダイレクトループ
```
[RFC7231]より
------------

A client SHOULD detect and intervene in cyclical redirections (i.e., "infinite" redirection loops).

Note: An earlier version of this specification recommended a maximum of five redirections ([RFC2068], Section 10.3).  Content developers need to be aware that some clients might implement such a fixed limitation. 
```
- クライアントはリダイレクトの無限ループに対して介入するべきである(SHOULD)。
- この仕様の以前のバージョンでは最大5回までが推奨されていた

---

## 300 Multiple Choices
```
[RFC7231]より
------------

The 300 (Multiple Choices) status code indicates that the target resource has more than one representation, each with its own more specific identifier, and information about the alternatives is being provided so that the user (or user agent) can select a preferred representation by redirecting its request to one or more of those identifiers.  In other words, the server desires that the user agent engage in reactive negotiation to select the most appropriate representation(s) for its needs (Section 3.4).

If the server has a preferred choice, the server SHOULD generate a Location header field containing a preferred choice's URI reference. The user agent MAY use the Location field value for automatic redirection.
```


- 対象のリソースが複数の表現をもち、それぞれが自身のより特定的な識別子をもつ。
- それらの代替えについての情報が提供されていて、ユーザーもしくはUAが優先する表現を選択し、1つ以上の識別子にリダイレクトする。
- 言い換えると、サーバーはUAがリアクティブネゴシエーションに参加し、ニーズに合わせて最も最適な表現を選択することを求める。
- サーバーが優先するべき選択を持っていたら、サーバーはその選択肢のURI参照を`Locaion`ヘッダーに含めるべき(SHOULD)。UAはその値を自動リダイレクトに利用してもよい(MAY)。

---

## 300 Multiple Choices

```
[RFC7231]より
------------

For request methods other than HEAD, the server SHOULD generate a payload in the 300 response containing a list of representation metadata and URI reference(s) from which the user or user agent can choose the one most preferred.  The user agent MAY make a selection from that list automatically if it understands the provided media type.  A specific format for automatic selection is not defined by this specification because HTTP tries to remain orthogonal to the definition of its payloads.  In practice, the representation is provided in some easily parsed format believed to be acceptable to the user agent, as determined by shared design or content negotiation, or in some commonly accepted hypertext format.

A 300 response is cacheable by default; i.e., unless otherwise indicated by the method definition or explicit cache controls (see Section 4.2.2 of [RFC7234]).
```

- `HEAD`以外のリクエストメソッドに対して、サーバーは300レスポンス内に、ユーザーもしくはUAが最も優先スべきものを選択できる表現メタデータとURI参照のリストを含むペイロードを生成するべき(SHOULD)。
- UAは提供されたメディアタイプを理解できるなら、そのリストの中から自動的に選択してもよい(MAY)。
- 特定のフォーマットについては仕様では定義されていない。
- 実際には、コンテントネゴシエーションや共有デザインによって決定される、UAが容易に解析できるフォーマット若しくは、一般的なハイパーテキストフォーマット。
- 300レスポンスはデフォルトでキャッシュ可能。

---
## 300 Multiple Choices

```
[RFC7231]より
------------


Note: The original proposal for the 300 status code defined the URI header field as providing a list of alternative representations, such that it would be usable for 200, 300, and 406 responses and be transferred in responses to the HEAD method. However, lack of deployment and disagreement over syntax led to both URI and Alternates (a subsequent proposal) being dropped from this specification.  It is possible to communicate the list using a set of Link header fields [RFC5988], each with a relationship of "alternate", though deployment is a chicken-and-egg problem.
```

---

## 301 Moved Permanently
```
[RFC7231]より
------------

The 301 (Moved Permanently) status code indicates that the target resource has been assigned a new permanent URI and any future references to this resource ought to use one of the enclosed URIs. Clients with link-editing capabilities ought to automatically re-link references to the effective request URI to one or more of the new references sent by the server, where possible. 

The server SHOULD generate a Location header field in the response containing a preferred URI reference for the new permanent URI.  The user agent MAY use the Location field value for automatic redirection.  The server's response payload usually contains a short hypertext note with a hyperlink to the new URI(s).

Note: For historical reasons, a user agent MAY change the request method from POST to GET for the subsequent request.  If this behavior is undesired, the 307 (Temporary Redirect) status code can be used instead.

A 301 response is cacheable by default
```
- 対象のリソースに新しい恒久的なURIが充てられていて、このリソースへの今後の参照は同封されたURIのいずれかを利用するべきことを指示する。
- リンク編集能力を備えたクライアントは、可能な場合、サーバーから送信された1つ以上の新しい参照に、有効的なリクエストURIへの参照を自動的に参照をリンクし直すべき。
- サーバーは新しい恒久的URIへのURI参照を含むレスポンスで`Location`ヘッダーフィールドを生成するべき(SHOULD)。
- UAは`Location`フィールドの値をつかって自動的にリダイレクトしてもよい(MAY)。
- サーバーからのレスポンスペイロードは、通常、新しいURIへのハイパーリンクを持つ短いハイパーテキストを含む。
- 歴史的経緯で、UAは後続のリクエストのメソッドをPOSTからGETへ変更してもよい(MAY)。この挙動が不都合な場合は代わりに307が利用できる。
- 301レスポンスはデフォルトでキャッシュ可能。

___

## 302 Found
```
The 302 (Found) status code indicates that the target resource resides temporarily under a different URI.  Since the redirection might be altered on occasion, the client ought to continue to use the effective request URI for future requests.

The server SHOULD generate a Location header field in the response containing a URI reference for the different URI.  The user agent MAY use the Location field value for automatic redirection.  The server's response payload usually contains a short hypertext note with a hyperlink to the different URI(s).

Note: For historical reasons, a user agent MAY change the request method from POST to GET for the subsequent request.  If this behavior is undesired, the 307 (Temporary Redirect) status code can be used instead.
```

- 対象のリソースが一時的に異なるURIのもとに配置されていることを指示する。
- リダイレクトはその都度変更される可能性があるため、クライアントは今後のリクエストに有効的なURIを利用し続けるべき。
- サーバーは異なるURIへのへの参照を含むレスポンス内に、`Location`ヘッダーフィールドを生成するべき(SHOULD)。
- UAは`Location`フィールドの値をつかって自動的にリダイレクトしてもよい(MAY)。
- サーバーからのレスポンスペイロードは、通常、新しいURIへのハイパーリンクを持つ短いハイパーテキストを含む。
- 歴史的経緯で、UAは後続のリクエストのメソッドをPOSTからGETへ変更してもよい(MAY)。この挙動が不都合な場合は代わりに307が利用できる。

---

## 303 See Other
```
[RFC7231]より
------------

The 303 (See Other) status code indicates that the server is redirecting the user agent to a different resource, as indicated by a URI in the Location header field, which is intended to provide an indirect response to the original request.  A user agent can perform a retrieval request targeting that URI (a GET or HEAD request if using HTTP), which might also be redirected, and present the eventual result as an answer to the original request.  Note that the new URI in the Location header field is not considered equivalent to the effective request URI.

This status code is applicable to any HTTP method.  It is primarily used to allow the output of a POST action to redirect the user agent to a selected resource, since doing so provides the information corresponding to the POST response in a form that can be separately identified, bookmarked, and cached, independent of the original request.
```

---
## 303 See Other

```
[RFC7231]より
------------

A 303 response to a GET request indicates that the origin server does not have a representation of the target resource that can be transferred by the server over HTTP.  However, the Location field value refers to a resource that is descriptive of the target resource, such that making a retrieval request on that other resource might result in a representation that is useful to recipients without implying that it represents the original target resource.  Note that answers to the questions of what can be represented, what representations are adequate, and what might be a useful description are outside the scope of HTTP.

Except for responses to a HEAD request, the representation of a 303 response ought to contain a short hypertext note with a hyperlink to the same URI reference provided in the Location header field. 
```

---

## 304 Not Modified ([RFC7232] Conditional Requests)
```
[RFC7232]より
------------

The 304 (Not Modified) status code indicates that a conditional GET or HEAD request has been received and would have resulted in a 200 (OK) response if it were not for the fact that the condition evaluated to false.  In other words, there is no need for the server to transfer a representation of the target resource because the request indicates that the client, which made the request conditional, already has a valid representation; the server is therefore redirecting the client to make use of that stored representation as if it were the payload of a 200 (OK) response.

The server generating a 304 response MUST generate any of the following header fields that would have been sent in a 200 (OK) response to the same request: Cache-Control, Content-Location, Date, ETag, Expires, and Vary.
```

---
## 304 Not Modified ([RFC7232])

```
[RFC7232]より
------------

Since the goal of a 304 response is to minimize information transfer when the recipient already has one or more cached representations, a sender SHOULD NOT generate representation metadata other than the above listed fields unless said metadata exists for the purpose of guiding cache updates (e.g., Last-Modified might be useful if the response does not have an ETag field).

Requirements on a cache that receives a 304 response are defined in Section 4.3.4 of [RFC7234].  If the conditional request originated with an outbound client, such as a user agent with its own cache sending a conditional GET to a shared proxy, then the proxy SHOULD forward the 304 response to that client.

A 304 response cannot contain a message-body; it is always terminated by the first empty line after the header fields.
```
---
## 305 Use Proxy
```
[RFC7231]より
------------

The 305 (Use Proxy) status code was defined in a previous version of this specification and is now deprecated (Appendix B).
```

---

## 306 (Unused)

```
[RFC7231]より
------------

The 306 status code was defined in a previous version of this specification, is no longer used, and the code is reserved.
```
- 以前のバージョンの仕様で定義されていたが、もう使用されない。ステータスコードは予約されている。
- かつて `306 Switch Proxy` として提案されていた
    - https://tools.ietf.org/html/draft-cohen-http-305-306-responses-00
    - 必ず(MUST)`Set-proxy`ヘッダと一緒に送られ、受け取ったクライアントは指定されたプロキシを使用する。

---

## 307 Temporary Redirect
```
[RFC7231]より
------------

The 307 (Temporary Redirect) status code indicates that the target resource resides temporarily under a different URI and the user agent MUST NOT change the request method if it performs an automatic redirection to that URI.  Since the redirection can change over time, the client ought to continue using the original effective request URI for future requests.

The server SHOULD generate a Location header field in the response containing a URI reference for the different URI.  The user agent MAY use the Location field value for automatic redirection.  The server's response payload usually contains a short hypertext note with a hyperlink to the different URI(s). 
```

---
## 307 Temporary Redirect
```
[RFC7231]より
------------

Note: This status code is similar to 302 (Found), except that it does not allow changing the request method from POST to GET.  This specification defines no equivalent counterpart for 301 (Moved Permanently) ([RFC7238], however, defines the status code 308 (Permanent Redirect) for this purpose). 
```

---

## 308 Permanent Redirect ([RFC7538])

```
[RFC7538]より
------------

The 308 (Permanent Redirect) status code indicates that the target resource has been assigned a new permanent URI and any future references to this resource ought to use one of the enclosed URIs. Clients with link editing capabilities ought to automatically re-link references to the effective request URI (Section 5.5 of [RFC7230]) to one or more of the new references sent by the server, where possible.

The server SHOULD generate a Location header field ([RFC7231], Section 7.1.2) in the response containing a preferred URI reference for the new permanent URI.  The user agent MAY use the Location field value for automatic redirection.  The server's response payload usually contains a short hypertext note with a hyperlink to the new URI(s).

```

---

## 308 Permanent Redirect ([RFC7538])

```
[RFC7538]より
------------

A 308 response is cacheable by default; i.e., unless otherwise indicated by the method definition or explicit cache controls (see [RFC7234], Section 4.2.2).

Note: This status code is similar to 301 (Moved Permanently) ([RFC7231], Section 6.4.2), except that it does not allow changing the request method from POST to GET.
```