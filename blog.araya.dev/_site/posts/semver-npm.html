
<!doctype>
<html lang="ja">

<head>
  <meta content='package.jsonでのセマンティックバージョン指定方法 - Allajah&#39;s Reservoir' name='title' />
  <meta content='package.jsonでのセマンティックバージョン指定方法 - Allajah&#39;s Reservoir' name='og:title' />
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="//necolas.github.io/normalize.css/7.0.0/normalize.css">
  <title>package.jsonでのセマンティックバージョン指定方法 - Allajah&#39;s Reservoir</title>
  <link href='http://blog.araya.dev/images/favicon.png' rel='shortcut icon'>
<link href='http://blog.araya.dev/assets/main.css' rel='stylesheet' type='text/css' />

<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

  <meta content='http://blog.araya.dev/posts/semver-npm.html' property='og:url' />
  <meta content="はじめに今までpacakge.jsonのバージョン指定をなんとなくやっていたり、npm install --saveで記述されるものをそのまま使ってたので、ちゃんとバージョン指定方法を理解しようと思いました。これはnpmの公式ドキュメ..." property='og:description' />
  <meta content="article" property="og:type" />

<!-- - -->


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-104175258-1', 'auto');
  ga('send', 'pageview');

</script>




</head>

<body>
  <header class="site-title">
    <a href="http://blog.araya.dev">
        <img src="http://blog.araya.dev/images/icon_circle.png" alt="Home" width="80" height="80">
      </a>
    <p>Allajah's Reservoir</p>
  </header>
  <div class="container">
      <nav aria-label="Main">
        <ul>
          
          <li>
            <a class="" href="http://blog.araya.dev/">
          Posts
        </a> 
          </li>
        </ul>
      </nav>
      <main class="">
        
          
          <div class="">28 Jun 2017</div>
          
          <h1 class="page-title"> package.jsonでのセマンティックバージョン指定方法 </h1>
          
          <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
          <script>
            ! function(d, s, id) {
              var js, fjs = d.getElementsByTagName(s)[0];
              if (!d.getElementById(id)) {
                js = d.createElement(s);
                js.id = id;
                js.src = "//platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js, fjs);
              }
            }(document, "script", "twitter-wjs");
          </script>
          <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="basic-label" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
<script
  type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>


          
        
        <div class="markdown-body">
          <h1 id="はじめに">はじめに</h1>
<p>今までpacakge.jsonのバージョン指定をなんとなくやっていたり、<code class="highlighter-rouge">npm install --save</code>で記述されるものをそのまま使ってたので、
ちゃんとバージョン指定方法を理解しようと思いました。</p>

<p>これは<a href="https://docs.npmjs.com/misc/semver">npmの公式ドキュメント</a>の一部を翻訳し、まとめたものです。
翻訳ミス等が分かり次第、修正しますので、教えていただけると幸いです。
また、翻訳に自信がない箇所が数カ所あります。</p>

<h1 id="npm-で使用するセマンティックバージョン">npm で使用するセマンティックバージョン</h1>

<h2 id="バージョン">バージョン</h2>
<ul>
  <li>バージョニングは http://semver.org/ で説明されている</li>
  <li><code class="highlighter-rouge">=</code>および<code class="highlighter-rouge">v</code>の2つの文字は取り除かれ、無視させる</li>
</ul>

<h2 id="レンジ">レンジ</h2>
<ul>
  <li>バージョンレンジは、レンジを満たすようにバージョンを指定する、comparatorにセットされる</li>
  <li>comparatorはoperatorとバージョンによって構成される。プリミティブなoperatorとして、
    <ul>
      <li><code class="highlighter-rouge">&lt;</code> 未満</li>
      <li><code class="highlighter-rouge">&lt;=</code> 以下</li>
      <li><code class="highlighter-rouge">&gt;</code> を超える</li>
      <li><code class="highlighter-rouge">&gt;=</code> 以上</li>
      <li><code class="highlighter-rouge">=</code> 等しい(operatorが指定されてなかった場合は、 <code class="highlighter-rouge">=</code>とみなされるため<code class="highlighter-rouge">=</code>は必須ではないが、書いたほうが良い)</li>
    </ul>

    <p>がある。</p>

    <p>例えば、comparatorが <code class="highlighter-rouge">&gt;=1.2.7</code> だったら、<code class="highlighter-rouge">1.2.7</code>、<code class="highlighter-rouge">1.2.8</code>、<code class="highlighter-rouge">2.5.3</code>、<code class="highlighter-rouge">1.3.9</code>、にはマッチするが、<code class="highlighter-rouge">1.2.6</code>や<code class="highlighter-rouge">1.1.0</code>にはマッチしない。</p>

    <p>複数のcomparatorはスペースによって結合されることで、comparator setを形成し、comparator setは全てのcomparatorが含んでいる交点によって満たされる。</p>

    <p>レンジは<code class="highlighter-rouge">||</code>で連結された1つ以上のcomparator setで構成される。バージョンは 、<code class="highlighter-rouge">||</code>で分離されたcomparator set のうち最低1つがバージョンによって満たされる場合にのみ、マッチする。</p>

    <p>例えば、<code class="highlighter-rouge">&gt;=1.2.7 &lt;1.3.0</code>というcomparator setは<code class="highlighter-rouge">1.2.7</code>、<code class="highlighter-rouge">1.2.8</code>、<code class="highlighter-rouge">1.2.99</code>にはマッチするが、<code class="highlighter-rouge">1.2.6</code>、<code class="highlighter-rouge">1.3.0</code>、<code class="highlighter-rouge">1.1.0</code>、にはマッチしない。</p>

    <p>さらに、<code class="highlighter-rouge">1.2.7 || &gt;=1.2.9 &lt;2.0.0</code> というレンジは、<code class="highlighter-rouge">1.2.7</code>、<code class="highlighter-rouge">1.2.9</code>、<code class="highlighter-rouge">1.4.6</code>にはマッチするが、<code class="highlighter-rouge">1.2.8</code>、<code class="highlighter-rouge">2.0.0</code>にはマッチしない</p>
  </li>
</ul>

<h2 id="プリリリースタグ">プリリリースタグ</h2>
<p>バージョンが <code class="highlighter-rouge">1.2.3-alpha.3</code> のようにプリリリースタグを持っていた場合、最低1つ以上のcomparatorがプリリリースを持っている[major, minor, patch]タプルと同じ場合のみ、comparator setを満たすことが許される</p>

<p>例えば、<code class="highlighter-rouge">&gt;1.2.3-alpha.3</code>は<code class="highlighter-rouge">1.2.3-alpha.7</code>とマッチ可能だが、<code class="highlighter-rouge">3.4.5-alpha.9</code>では満たされない。<code class="highlighter-rouge">3.4.5-alpha.9</code>が、セマンティックバージョニングで技術的には<code class="highlighter-rouge">1.2.3-alpha.7</code>より大きくてもだ。</p>

<p>このふるまいの意図は2つある。</p>

<p>1つは、プリリリースバージョンは非常に高頻度でアップデートされ、多数の未だ一般的な消費と合わない破壊的変更を含むことだ。したがって、デフォルトでは、プリリリースバージョンは意味論的なマッチングのレンジからは除外される。</p>

<p>2つ目として、プリリースバージョンの使用を選んだユーザーはalpha/beta/rc バージョンのセットを使用する意図が明確に示されている。
レンジにプリリースバージョンタグを含めることで、ユーザーはリスクを認識していることを示している。
しかし、ユーザーが次のプリリリースバージョンでも同様なリスクを取ることを選択したと改定するには、適切ではない。</p>

<h2 id="応用的なレンジシンタックス">応用的なレンジシンタックス</h2>
<p>応用的レンジシンタックスはプリミティブなcomparatorを決定論的な方法でdesugarする
応用的なレンジはスペースまたは||を用いたプリミティブcomparatorと同じ方法で結合される</p>

<h3 id="ハイフンレンジ-xyz---abc">ハイフンレンジ X.Y.Z - A.B.C</h3>
<p>包括的セットを指定
<code class="highlighter-rouge">1.2.3 - 2.3.4 := &gt;=1.2.3 &lt;=2.3.4</code>
包括的レンジの最初のバージョンとして部分的なバージョンが提供されていたら、省略された部分はゼロに置き換えられる。
<code class="highlighter-rouge">1.2 - 2.3.4 := &gt;=1.2.0 &lt;=2.3.4</code>
部分的なバージョンが包括的レンジの2つ目の値として与えられていたら、タプルの与えられた部分で始まる全てのバージョンが受け入れられるが、
提供されたタプルパーツよりも大きくなることはない。
<code class="highlighter-rouge">1.2.3 - 2.3 := &gt;=1.2.3 &lt;2.4.0</code>
<code class="highlighter-rouge">1.2.3 - 2 := &gt;=1.2.3 &lt;3.0.0</code></p>

<h3 id="x-レンジ-12x-1x-12-">X-レンジ 1.2.x 1.X 1.2.* *</h3>
<p><code class="highlighter-rouge">X</code>、<code class="highlighter-rouge">x</code>、<code class="highlighter-rouge">*</code> はいずれもタプルの1つの数値で、「すべての値」を表すのに用いられる。</p>
<ul>
  <li>* := &gt;=0.0.0 (どんなバージョンでも満たす)</li>
  <li>1.x := &gt;=1.0.0 &lt;2.0.0 (メジャーバージョンが同じものにマッチする)</li>
  <li>1.2.x := &gt;=1.2.0 &lt;1.3.0 (メジャーバージョンとマイナーバージョンが同じものにマッチする)
部分的バージョンはX-レンジとして扱われるため、特別な文字は事実上オプショナルである。</li>
  <li>”” (空文字) := * := &gt;=0.0.0</li>
  <li>1 := 1.x.x := &gt;=1.0.0 &lt;2.0.0</li>
  <li>1.2 := 1.2.x := &gt;=1.2.0 &lt;1.3.0</li>
</ul>

<h3 id="チルダレンジ-123-12-1">チルダレンジ ~1.2.3 ~1.2 ~1</h3>
<p>マイナーバージョンがcomparatorに指定されていた場合、パッチレベルの変更を許容する。</p>
<ul>
  <li>~1.2.3 := &gt;=1.2.3 &lt;1.(2+1).0 := &gt;=1.2.3 &lt;1.3.0</li>
  <li>~1.2 := &gt;=1.2.0 &lt;1.(2+1).0 := &gt;=1.2.0 &lt;1.3.0 (1.2.xと同じ)</li>
  <li>~1 := &gt;=1.0.0 &lt;(1+1).0.0 := &gt;=1.0.0 &lt;2.0.0 (1.xと同じ)</li>
  <li>~0.2.3 := &gt;=0.2.3 &lt;0.(2+1).0 := &gt;=0.2.3 &lt;0.3.0</li>
  <li>~0.2 := &gt;=0.2.0 &lt;0.(2+1).0 := &gt;=0.2.0 &lt;0.3.0 (0.2.xと同じ)</li>
  <li>~0 := &gt;=0.0.0 &lt;(0+1).0.0 := &gt;=0.0.0 &lt;1.0.0 (0.xと同じ)</li>
  <li>~1.2.3-beta.2 := &gt;=1.2.3-beta.2 &lt;1.3.0 (beta.2以上の1.2.3のプリリースバージョンが許可されることに注意。
<code class="highlighter-rouge">1.2.3-beta.4</code>は許可されるが、<code class="highlighter-rouge">1.2.4-beta.2</code>は[major, minor, patch]タプルとマッチしないプリリースのため許可されない。)</li>
</ul>

<h3 id="キャレットレンジ-123-025-004">キャレットレンジ ^1.2.3 ^0.2.5 ^0.0.4</h3>
<p>[major, minor, patch]タプルの一番左のゼロではない数字を変更しない変更を許可する。
言い換えると、これはバージョン<code class="highlighter-rouge">1.0.0</code>以上ではpatchとminorのアップデートを許容し、<code class="highlighter-rouge">0.X &gt;= 0.1.0</code>ではpatchアップデートを許可し、
<code class="highlighter-rouge">0.0.X</code>ではアップデートが行われない。</p>

<p>多くの作者は<code class="highlighter-rouge">x</code>がブレイキングチェンジインディケータであるように<code class="highlighter-rouge">0.x</code>バージョンを扱う。
キャレットレンジは作者が<code class="highlighter-rouge">0.2.4</code>で<code class="highlighter-rouge">0.3.0</code>でブレイキングチェンジを行うかもしれない場合は理想的であり、一般的な手法である。
しかし、これは<code class="highlighter-rouge">0.2.4</code>と<code class="highlighter-rouge">0.2.5</code>の間でブレイキングチェンジがないということを仮定している。
これは一般的に観察されているプラクティスによると、(ブレイキングチェンジではない)追加があることが仮定された変更を許可する。</p>
<ul>
  <li>^1.2.3 := &gt;=1.2.3 &lt;2.0.0</li>
  <li>^0.2.3 := &gt;=0.2.3 &lt;0.3.0</li>
  <li>^0.0.3 := &gt;=0.0.3 &lt;0.0.4</li>
  <li>^1.2.3-beta.2 := &gt;=1.2.3-beta.2 &lt;2.0.0
<code class="highlighter-rouge">1.2.3</code>のプリリースバージョンが<code class="highlighter-rouge">beta.2</code>以上の場合許可されることに注意。
そのため、<code class="highlighter-rouge">1.2.3-beta.4</code>は許可されるが、<code class="highlighter-rouge">1.2.4-beta.2</code>は許可されない。</li>
  <li>^0.0.3-beta := &gt;=0.0.3-beta &lt;0.0.4
<code class="highlighter-rouge">0.0.3</code>のプリリリースのみが許可されることに注意。つまり、<code class="highlighter-rouge">0.0.3-pr.2</code>が許可される。</li>
</ul>

<p>キャレットレンジをパースする時、省略された<code class="highlighter-rouge">patch</code>の値は<code class="highlighter-rouge">0</code>にdesugarするが、majorとminorの値がどちらも0の場合であってもその数値の柔軟性を許容する。</p>
<ul>
  <li>^1.2.x := &gt;=1.2.0 &lt;2.0.0</li>
  <li>^0.0.x := &gt;=0.0.0 &lt;0.1.0</li>
  <li>^0.0 := &gt;=0.0.0 &lt;0.1.0</li>
</ul>

<p>省略された<code class="highlighter-rouge">minor</code>と<code class="highlighter-rouge">patch</code>の値は0にdesugarするが、majorの値が0であってもそれらの値の中で柔軟性を許容する。</p>
<ul>
  <li>^1.x := &gt;=1.0.0 &lt;2.0.0</li>
  <li>^0.x := &gt;=0.0.0 &lt;1.0.0</li>
</ul>

<h1 id="まとめ">まとめ</h1>

<ul>
  <li><code class="highlighter-rouge">~</code>と<code class="highlighter-rouge">^</code> はよく使うけど、意味をちゃんと知らないと意図しないバージョンのパッケージがインストールされてしまうことがあるため注意。</li>
</ul>

        </div>
        <p class="mt4">
  Allajah
  <span class="silver">at 16:02</span>
</p>


      </main>
  </div>
  <footer class="footer">
    <div class="footer-sns">
      <a href="https://twitter.com/_araya_" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter"></i></a>
      <a href="https://github.com/allajah" target="_blank" rel="noopener noreferrer"><i class="fa fa-github"></i></a>
      <a href="/feed.xml" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss"></i></a>
    </div>
  </footer>
</body>

</html>
